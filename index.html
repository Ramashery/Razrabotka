<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Ускорение соединения с базой данных -->
    <link rel="preconnect" href="https://firestore.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="//firestore.googleapis.com">
    
    <title>Web Development & SEO Services in Tbilisi, Georgia | Digital Craft</title>
    <meta name="description" content="Professional web development and SEO services based in Tbilisi. We build high-performance websites for small and medium businesses.">
    
    <!-- Базовые Open Graph теги (будут обновлены скриптом) -->
    <meta property="og:title" content="Digital Craft - Web Development" />
    <meta property="og:description" content="Professional web development and SEO services based in Tbilisi." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://digital-craft-tbilisi.site" />
    <meta property="og:image" content="" />

    <link rel="icon" href="/favicon.svg" type="image/svg+xml">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <!-- --- КОНТЕЙНЕР ДЛЯ SCHEMA.ORG (JSON-LD) --- -->
    <script type="application/ld+json" id="dynamic-schema-json">{}</script>

    <!-- --- EARLY SEO BOOTSTRAP SCRIPT --- -->
    <script>
        (function earlySeoBootstrap() {
            try {
                // Конфигурация
                var API_KEY = "AIzaSyAT4dDEIDUtzP60ibjahO06P75Q6h95ZN4";
                var PROJECT_ID = "razrabotka-b61bc";
                
                // 1. Разбираем URL
                var path = window.location.pathname;
                // Регулярка для определения страницы: /lang/collection/slug
                var match = path.match(/^\/(?:([a-z]{2})\/)?(services|portfolio|blog|contact)\/([a-zA-Z0-9-]+)\/?$/);
                
                var collection, slug, isHome;
                
                if (match) {
                    collection = match[2];
                    slug = match[3];
                    isHome = false;
                } else {
                    isHome = true;
                }

                // 2. Формируем запрос к Firestore REST API
                var endpoint;
                var method = 'GET';
                var body = null;

                if (isHome) {
                    // Запрос главной страницы (прямой доступ к документу)
                    endpoint = "https://firestore.googleapis.com/v1/projects/" + PROJECT_ID + "/databases/(default)/documents/home/content?key=" + API_KEY;
                } else {
                    // Запрос внутренней страницы (поиск по slug)
                    endpoint = "https://firestore.googleapis.com/v1/projects/" + PROJECT_ID + "/databases/(default)/documents:runQuery?key=" + API_KEY;
                    method = 'POST';
                    body = JSON.stringify({
                        structuredQuery: {
                            from: [{ collectionId: collection }],
                            where: {
                                fieldFilter: {
                                    field: { fieldPath: 'urlSlug' },
                                    op: 'EQUAL',
                                    value: { stringValue: slug }
                                }
                            },
                            limit: 1
                        }
                    });
                }

                // 3. Выполняем запрос
                fetch(endpoint, {
                    method: method,
                    headers: method === 'POST' ? { 'Content-Type': 'application/json' } : {},
                    body: body
                })
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    // Извлекаем документ
                    var doc = null;
                    if (isHome) {
                        doc = data; // При прямом GET документ приходит сразу
                    } else if (Array.isArray(data) && data.length > 0 && data[0].document) {
                        doc = data[0].document; // При runQuery документ внутри массива
                    }

                    // Определяем тип схемы
                    var schemaType = 'WebSite';
                    if (!isHome) {
                        if (collection === 'services') schemaType = 'Service';
                        else if (collection === 'blog') schemaType = 'BlogPosting';
                        else if (collection === 'portfolio') schemaType = 'CreativeWork';
                        else schemaType = 'WebPage';
                    }
                    
                    processDoc(doc, schemaType);
                })
                .catch(function(e) { 
                    // Ошибки игнорируем, main.js загрузит данные позже
                });

                // 4. Функция обработки и вставки данных
                function processDoc(doc, type) {
                    if (!doc || !doc.fields) return;
                    var fields = doc.fields;
                    
                    // Извлекаем значения (Firestore REST API возвращает {stringValue: "..."})
                    var title = (fields.seoTitle && fields.seoTitle.stringValue) || (fields.h1 && fields.h1.stringValue) || (fields.title && fields.title.stringValue) || '';
                    var desc = (fields.metaDescription && fields.metaDescription.stringValue) || (fields.description && fields.description.stringValue) || '';
                    var image = (fields.media && fields.media.arrayValue && fields.media.arrayValue.values && fields.media.arrayValue.values[0]) 
                                ? fields.media.arrayValue.values[0].stringValue 
                                : '';
                    
                    // Очистка URL для canonical
                    var canonicalUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;

                    // --- ОБНОВЛЕНИЕ DOM ---
                    
                    // 1. Title & Description
                    if (title) document.title = title + (isHome ? "" : " | Digital Craft");
                    var metaDesc = document.querySelector('meta[name="description"]');
                    if (metaDesc && desc) metaDesc.setAttribute('content', desc);

                    // 2. Canonical
                    var linkCanon = document.querySelector('link[rel="canonical"]');
                    if (!linkCanon) {
                        linkCanon = document.createElement('link');
                        linkCanon.rel = 'canonical';
                        document.head.appendChild(linkCanon);
                    }
                    linkCanon.setAttribute('href', canonicalUrl);

                    // 3. Open Graph
                    var ogTitle = document.querySelector('meta[property="og:title"]');
                    if (ogTitle && title) ogTitle.setAttribute('content', title);
                    
                    var ogDesc = document.querySelector('meta[property="og:description"]');
                    if (ogDesc && desc) ogDesc.setAttribute('content', desc);
                    
                    var ogUrl = document.querySelector('meta[property="og:url"]');
                    if (ogUrl) ogUrl.setAttribute('content', canonicalUrl);

                    if (image && !image.includes('youtube')) {
                        var ogImg = document.querySelector('meta[property="og:image"]');
                        if (!ogImg) {
                            ogImg = document.createElement('meta');
                            ogImg.setAttribute('property', 'og:image');
                            document.head.appendChild(ogImg);
                        }
                        ogImg.setAttribute('content', image);
                    }

                    // 4. JSON-LD Schema
                    // Если есть готовая схема в базе - берем её
                    if (fields.schemaJsonLd && fields.schemaJsonLd.stringValue) {
                        try {
                            // Проверяем валидность JSON
                            JSON.parse(fields.schemaJsonLd.stringValue);
                            document.getElementById('dynamic-schema-json').textContent = fields.schemaJsonLd.stringValue;
                            return;
                        } catch(e) {}
                    }

                    // Иначе генерируем fallback схему
                    var schema = {
                        "@context": "https://schema.org",
                        "@type": type,
                        "name": title,
                        "description": desc,
                        "url": canonicalUrl
                    };

                    if (image && !image.includes('youtube')) {
                        schema.image = image;
                    }

                    if (type === 'BlogPosting') {
                        schema.headline = title;
                        schema.articleBody = desc; 
                        schema.author = { "@type": "Organization", "name": "Digital Craft" };
                    }

                    document.getElementById('dynamic-schema-json').textContent = JSON.stringify(schema);
                }

            } catch (e) {}
        })();
    </script>

    <!-- --- КРИТИЧЕСКИЙ CSS --- -->
    <style>
        :root {
            --color-bg: #030409;
            --color-text: #FFFFFF;
            --color-accent: #b8d8e8;
        }
        body { 
            margin: 0; 
            padding: 0; 
            background-color: var(--color-bg); 
            color: var(--color-text);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }
        #loader { 
            position: fixed; 
            top: 0; left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--color-bg); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            z-index: 10000; 
            transition: opacity 0.5s ease-out; 
        }
        #loader.hidden { opacity: 0; pointer-events: none; }
        .spinner { 
            width: 50px; 
            height: 50px; 
            border: 3px solid var(--color-accent); 
            border-radius: 50%; 
            border-top-color: transparent; 
            animation: spin 1s linear infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>

    <!-- --- АСИНХРОННАЯ ЗАГРУЗКА ОСНОВНЫХ СТИЛЕЙ --- -->
    <link rel="stylesheet" href="/styles.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="/styles.css"></noscript>

</head>
<body>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/103413242" style="position:absolute; left:-9999px;" alt=""></div>
        
        <header>
            <h1>Digital Craft - Web Development & SEO in Tbilisi</h1>
            <p>We create professional, high-performance websites and provide SEO services for small and medium businesses in Tbilisi, Georgia.</p>
        </header>

        <section id="services-static">
            <h2>Our Services</h2>
            <ul>
                <li><a href="/en/services/web-development">Web Development</a></li>
                <li><a href="/en/services/seo-optimization">SEO Optimization</a></li>
                <li><a href="/en/services/ui-ux-design">UI/UX Design</a></li>
            </ul>
        </section>

        <section id="portfolio-static">
            <h2>Our Portfolio</h2>
            <p>Explore our recent projects and success stories.</p>
            <a href="/en/portfolio">View All Projects</a>
        </section>

        <section id="contact-static">
            <h2>Get in Touch</h2>
            <p>Ready to start your project? Contact us today.</p>
            <a href="/en/contact">Contact Us</a>
        </section>
    </noscript>

    <div id="loader"><div class="spinner"></div></div>
    <iframe id="custom-background-iframe" title="Custom Background"></iframe>
    <button class="menu-toggle" aria-label="Toggle menu">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>
    <div class="nav-overlay">
        <ul class="nav-menu"></ul>
    </div>

    <main></main>
    
    <footer class="site-footer" id="site-footer"></footer>
    
    <!-- ОСНОВНОЙ СКРИПТ ПРИЛОЖЕНИЯ -->
    <script type="module" src="/main.js"></script>
    
    <!-- Отложенная загрузка Яндекс.Метрики -->
    <script type="text/javascript">
        function loadYandexMetrika() {
            (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
            (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
            ym(103413242, "init", {
                 clickmap:true,
                 trackLinks:true,
                 accurateTrackBounce:true,
                 webvisor:true
            });
        }
        setTimeout(loadYandexMetrika, 3000); 
    </script>

</body>
</html>